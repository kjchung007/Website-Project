<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kopi Papa - Reset Password</title>
    <link rel="stylesheet" href="../CSS/registration.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <a href="home.html"> <img src="../Image/KopiPapa Logo.png" alt="Kopi Papa Logo" class="logo">
        <div>
            <a href="home.html">HOME</a>
            <a href="menu.html">MENU</a>
            <a href="rewards.html">REWARDS</a>
            <a href="collab.html" class="collab-btn">COLLAB</a>
            <a href="about us.html">ABOUT US</a>
            <a href="cart.html">CART</a>
            <a href="registration.html"><i class="fa-solid fa-user"></i></a>
        </div>
    </nav>
    
    <div class="auth-container">
        <div class="auth-box">
            <img src="../Image/KopiPapa Logo.png" alt="Kopi Papa Logo" class="auth-logo">
            <h2>Reset Password</h2>
            <p class="password-tip">Make sure it's something you'll remember</p>
            <br>
            <form id="reset-password" onsubmit="return validatePasswordReset(event)">
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <div class="password-input">
                        <input type="password" id="newPassword" name="newPassword" placeholder="New Password" required>
                        <i class="fas fa-eye-slash toggle-password" onclick="togglePassword('newPassword')"></i>
                    </div>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <div class="password-input">
                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm Password" required>
                        <i class="fas fa-eye-slash toggle-password" onclick="togglePassword('confirmPassword')"></i>
                    </div>
                </div>
                <button type="submit" class="auth-button">Reset Password</button>
            </form>
            <p class="auth-switch">Remembered your password? <a href="login.html">Log in</a></p>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>Copyright &copy; 2023 Kopi Papa. All rights reserved.</p>
            <div class="social-icons">
                <a href="https://www.facebook.com/profile.php?id=61556348262104" target="_blank"><i class="fab fa-facebook"></i></a>
                <a href="https://www.instagram.com/kopipapahq/?hl=en" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://www.tiktok.com/@kopi.papa.hq" target="_blank"><i class="fab fa-tiktok"></i></a>
            </div>
        </div>
    </footer>
    
    <script src="../Javascript/registration.js"></script>

    <script>
        // Password Reset Validation and Redirect
function validatePasswordReset(event) {
    event.preventDefault();

    // Get password and confirm password values
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    // Define the password format regex
    const passwordPattern = /^(?=.*[A-Z])(?=.*\d)(?=.*[\W_])(?!.*\s).{6,8}$/;

    // Check if the new password matches the required format
    if (!passwordPattern.test(newPassword)) {
        alert('Password must be between 6-8 characters, include at least one uppercase letter, one number, one special character, and no spaces.');
        return false; // Prevent form submission
    }

    // Check if passwords match
    if (newPassword !== confirmPassword) {
        alert('Passwords do not match!');
    } else {
        // Get email from sessionStorage (This should be stored earlier after the PIN verification)
        const email = sessionStorage.getItem('userEmail');
        if (!email) {
            alert('Session expired. Please request a new verification code.');
            window.location.href = 'forgotpassword1.html';
            return false;
        }

        // Create FormData object
        const formData = new FormData();
        formData.append('email', email); // Pass the email to reset password
        formData.append('newPassword', newPassword);

        // Send the new password to the server for updating the database
        fetch('../PHP/reset_password.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alert(data.message);
                window.location.href = "forgotpassword4.html";  // Redirect to login page after password reset
            } else {
                alert(data.message);  // Show error message if any
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        });
    }

    return false;  // Prevent form submission
}

    </script>
</body>
</html>
